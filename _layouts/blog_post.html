---
layout: default
---

<div class="row">
  <div class="col-lg-8">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          {{ page.title }}
        </h1>
        <p class="post-meta">
          <time
            datetime="{{ page.date | date_to_xmlschema }}"
            itemprop="datePublished"
            >{{ page.date | date: "%b %-d, %Y" }}</time
          >{% if page.author %} â€¢
          <span itemprop="author" itemscope itemtype="http://schema.org/Person"
            ><span itemprop="name">{{ page.author }}</span></span
          >{% endif %}
        </p>
      </header>
      <div class="post-content" itemprop="articleBody">{{ content }}</div>
    </article>

    <div class="next-previous-articles">
      <nav aria-label="">
        <ul class="pagination">
          {% if page.next.url %}
          <li class="page-item">
            <a class="page-link" href="{{page.next.url}}" tabindex="-1"
              >&laquo; {{page.next.title}}</a
            >
          </li>
          {% endif %} {% if page.previous.url %}
          <li class="page-item">
            <a class="page-link" href="{{page.previous.url}}"
              >{{page.previous.title}} &raquo;</a
            >
          </li>
          {% endif %}
        </ul>
      </nav>
    </div>

    <div class="">
      {% if site.disqus-shortname %} {% include disqus.html %} {% endif %}
    </div>
  </div>

  <!-- Sidebar with TOC and Recent Articles -->
  <div class="col-lg-4">
    <!-- Table of Contents -->
    <div class="blog-toc">
      <h4>ðŸ“– Table of Contents</h4>
      <ul id="toc-list">
        <!-- TOC will be generated by JavaScript -->
      </ul>
    </div>

    <!-- Recent Articles -->
    <div class="recent-articles">
      <h4>ðŸ“š Recent Articles</h4>
      {% assign recent_posts = site.blog_posts | limit: 5 %}
      {% if recent_posts.size > 0 %}
        {% for post in recent_posts %}
          <a href="{{ post.url | prepend: site.baseurl }}" class="recent-post">
            <div class="post-title">{{ post.title | truncate: 60 }}</div>
            <div class="post-date">{{ post.date | date: "%b %-d, %Y" }}</div>
            {% if post.tags %}
              <div class="post-tags">
                {% for tag in post.tags limit: 3 %}
                  <span class="badge badge-{{ post.colors[forloop.index0] }}">{{ tag }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </a>
        {% endfor %}
      {% else %}
        <p class="text-muted"><small>No recent articles found.</small></p>
      {% endif %}
    </div>
  </div>
</div>

<!-- TOC Generation Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Wait a bit for content to fully load
  setTimeout(function() {
    // Try the exact selector from the HTML structure
    const headings = document.querySelectorAll('.post-content h1, .post-content h2, .post-content h3, .post-content h4');
    const tocList = document.getElementById('toc-list');
    const tocContainer = document.querySelector('.blog-toc');
    
    console.log('Found headings:', headings.length);
    console.log('All headings on page:', document.querySelectorAll('h1, h2, h3, h4').length);
    console.log('Post content exists:', document.querySelector('.post-content') !== null);
    
    if (headings.length === 0) {
      console.log('No headings found in .post-content, hiding TOC');
      if (tocContainer) {
        tocContainer.style.display = 'none';
      }
      return;
    }
    
    // Clear any existing manual TOC
    tocList.innerHTML = '';
    
    // Filter out the main title if it's duplicated in content
    const contentHeadings = Array.from(headings).filter(function(heading, index) {
      // Skip if it's the same as the page title
      const pageTitle = document.querySelector('.post-title');
      if (pageTitle && heading.textContent.trim() === pageTitle.textContent.trim()) {
        return false;
      }
      return true;
    });
    
    console.log('Content headings after filtering:', contentHeadings.length);
    
    if (contentHeadings.length === 0) {
      if (tocContainer) {
        tocContainer.style.display = 'none';
      }
      return;
    }
    
    contentHeadings.forEach(function(heading, index) {
      // Add ID to heading if it doesn't have one
      if (!heading.id) {
        const headingText = heading.textContent.trim().toLowerCase()
          .replace(/[^\w\s-]/g, '') // Remove special characters
          .replace(/\s+/g, '-') // Replace spaces with hyphens
          .substring(0, 50); // Limit length
        heading.id = headingText || 'heading-' + index;
      }
      
      // Create TOC item
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#' + heading.id;
      a.textContent = heading.textContent;
      a.className = 'toc-link';
      
      // Add nesting based on heading level
      if (heading.tagName === 'H3' || heading.tagName === 'H4') {
        li.style.marginLeft = '1rem';
        a.style.fontSize = '0.85rem';
        a.style.color = '#888';
      }
      
      li.appendChild(a);
      tocList.appendChild(li);
    });
    
    console.log('TOC generated with', contentHeadings.length, 'items');
    
    // Smooth scrolling for TOC links
    document.querySelectorAll('.toc-link').forEach(function(link) {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          const offsetTop = targetElement.offsetTop - 100;
          window.scrollTo({
            top: offsetTop,
            behavior: 'smooth'
          });
        }
      });
    });
    
    // Highlight current section in TOC
    function highlightCurrentSection() {
      const scrollPosition = window.scrollY + 150;
      let currentSection = null;
      
      contentHeadings.forEach(function(heading) {
        if (heading.offsetTop <= scrollPosition) {
          currentSection = heading;
        }
      });
      
      // Remove active class from all links
      document.querySelectorAll('.toc-link').forEach(function(link) {
        link.classList.remove('active');
      });
      
      // Add active class to current section
      if (currentSection) {
        const activeLink = document.querySelector(`a[href="#${currentSection.id}"]`);
        if (activeLink) {
          activeLink.classList.add('active');
        }
      }
    }
    
    // Update active section on scroll (throttled)
    let ticking = false;
    function updateTOC() {
      if (!ticking) {
        requestAnimationFrame(function() {
          highlightCurrentSection();
          ticking = false;
        });
        ticking = true;
      }
    }
    
    window.addEventListener('scroll', updateTOC);
    highlightCurrentSection(); // Initial call
    
  }, 1000); // Increased timeout to 1 second
});
</script>

{% include fb-script.html %}