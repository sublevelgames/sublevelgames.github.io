<!-- Safe Navigation - Uses existing structure without breaking anything -->
{% comment %}
Uses existing collections:
- site.posts = Games (shown on main page)
- site.blog_posts = Blog posts (shown on /blogs/)
{% endcomment %}

<!-- Count recent games from site.posts (last 2 weeks) -->
{% assign new_games_count = 0 %}
{% if site.posts %}
  {% for post in site.posts limit: 20 %}
    {% if post.date %}
      {% assign days_old = 'now' | date: '%s' | minus: post.date | date: '%s' | divided_by: 86400 %}
      {% if days_old <= 14 %}
        {% assign new_games_count = new_games_count | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endif %}

<!-- Count recent blog posts from site.blog_posts (last 2 weeks) -->
{% assign new_blogs_count = 0 %}
{% if site.blog_posts %}
  {% for post in site.blog_posts limit: 20 %}
    {% if post.date %}
      {% assign days_old = 'now' | date: '%s' | minus: post.date | date: '%s' | divided_by: 86400 %}
      {% if days_old <= 14 %}
        {% assign new_blogs_count = new_blogs_count | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endif %}

<nav class="container navbar navbar-expand-lg navbar-light bg-transparent">
  <a class="navbar-brand" href={{"/" | relative_url}}>üïπÔ∏èsublevelgames</a>
  <button
    class="navbar-toggler"
    type="button"
    data-toggle="collapse"
    data-target="#navbarSupportedContent"
    aria-controls="navbarSupportedContent"
    aria-expanded="false"
    aria-label="Toggle navigation"
  >
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <!-- Í≤ÄÏÉâ Ìèº -->
    <div class="search-wrapper mr-auto">
      <input type="text" id="search-input" class="form-control" placeholder="Search games...">
      <ul id="results-container" class="search-results"></ul>
    </div>

    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" href={{"/" | relative_url}}>
          Games
          {% if new_games_count > 0 %}
            <small class="text-success font-weight-bold">({{ new_games_count }})</small>
          {% endif %}
          <span class="sr-only">(current)</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href={{"/blogs/" | relative_url}}>
          Blogs
          {% if new_blogs_count > 0 %}
            <small class="text-primary font-weight-bold">({{ new_blogs_count }})</small>
          {% endif %}
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href={{"/tags/" | relative_url}}>Tags</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href={{"/about/" | relative_url}}>About</a>
      </li>
    </ul>
  </div>

  <!-- Simple Jekyll Search Ïä§ÌÅ¨Î¶ΩÌä∏ -->
  <script src="https://unpkg.com/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var sjs = SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '{{ "/search.json" | relative_url }}',
        searchResultTemplate: '<li><a href="{url}">{title}</a> <small>{tags}</small></li>',
        noResultsText: 'No results found',
        limit: 10,
        fuzzy: false
      });
    });
  </script>
</nav>

<style>
/* Clean counter styling that won't interfere with existing styles */
.nav-link small {
  font-size: 0.75rem;
  vertical-align: top;
  margin-left: 0.25rem;
  display: inline-block;
  border-radius: 8px;
  padding: 0.1rem 0.3rem;
  line-height: 1.2;
}

/* Subtle hover animation */
.nav-link:hover small {
  transform: scale(1.05);
  transition: transform 0.2s ease;
}

/* Ensure it doesn't break mobile layout */
@media (max-width: 768px) {
  .nav-link small {
    font-size: 0.7rem;
    margin-left: 0.2rem;
    padding: 0.05rem 0.2rem;
  }
}
</style>

<!-- Debug Information (remove in production) -->
<script>
console.log('üéÆ Safe Navigation Debug:');
console.log('Games (site.posts):', {{ site.posts.size | default: 0 }});
console.log('Blogs (site.blog_posts):', {{ site.blog_posts.size | default: 0 }});
console.log('New games count:', {{ new_games_count }});
console.log('New blogs count:', {{ new_blogs_count }});
console.log('Current structure maintained - no changes to collections');

// Test if recent posts exist
{% if site.posts.size > 0 %}
console.log('Recent game:', '{{ site.posts.first.title }}', '{{ site.posts.first.date }}');
{% endif %}
{% if site.blog_posts.size > 0 %}
console.log('Recent blog:', '{{ site.blog_posts.first.title }}', '{{ site.blog_posts.first.date }}');
{% endif %}
</script>