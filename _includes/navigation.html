<!-- Safe Navigation with NEW badges - Compatible with Jekyll 3.8 -->
{% comment %}
This version uses a simpler date comparison method that works with older Jekyll versions
{% endcomment %}

<!-- Calculate date threshold (2 weeks ago) -->
{% assign today = 'now' | date: '%s' %}
{% assign two_weeks_ago = today | minus: 1209600 %}

<!-- Check for new games - using simpler logic -->
{% assign has_new_games = false %}
{% assign new_games_count = 0 %}

{% if site.games %}
  {% for game in site.games limit: 50 %}
    {% if game.date %}
      {% assign game_timestamp = game.date | date: '%s' %}
      {% assign game_timestamp_num = game_timestamp | plus: 0 %}
      {% assign threshold_num = two_weeks_ago | plus: 0 %}
      {% if game_timestamp_num > threshold_num %}
        {% assign has_new_games = true %}
        {% assign new_games_count = new_games_count | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endif %}

<!-- Check for new blog posts -->
{% assign has_new_blogs = false %}
{% assign new_blogs_count = 0 %}

{% if site.blog_posts %}
  {% for post in site.blog_posts limit: 50 %}
    {% if post.date %}
      {% assign post_timestamp = post.date | date: '%s' %}
      {% assign post_timestamp_num = post_timestamp | plus: 0 %}
      {% assign threshold_num = two_weeks_ago | plus: 0 %}
      {% if post_timestamp_num > threshold_num %}
        {% assign has_new_blogs = true %}
        {% assign new_blogs_count = new_blogs_count | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% elsif site.posts %}
  {% for post in site.posts limit: 50 %}
    {% if post.date %}
      {% assign post_timestamp = post.date | date: '%s' %}
      {% assign post_timestamp_num = post_timestamp | plus: 0 %}
      {% assign threshold_num = two_weeks_ago | plus: 0 %}
      {% if post_timestamp_num > threshold_num %}
        {% assign has_new_blogs = true %}
        {% assign new_blogs_count = new_blogs_count | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endif %}

<nav class="container navbar navbar-expand-lg navbar-light bg-transparent">
  <a class="navbar-brand" href={{"/" | relative_url}}>üïπÔ∏èsublevelgames</a>
  <button
    class="navbar-toggler"
    type="button"
    data-toggle="collapse"
    data-target="#navbarSupportedContent"
    aria-controls="navbarSupportedContent"
    aria-expanded="false"
    aria-label="Toggle navigation"
  >
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <!-- Í≤ÄÏÉâ Ìèº Ï∂îÍ∞Ä -->
    <div class="search-wrapper mr-auto">
      <input type="text" id="search-input" class="form-control" placeholder="Search games...">
      <ul id="results-container" class="search-results"></ul>
    </div>

    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" href={{"/" | relative_url}}>
          Games
          {% if has_new_games %}
            <span class="new-badge">NEW{% if new_games_count > 1 %}<sup>{{ new_games_count }}</sup>{% endif %}</span>
          {% endif %}
          <span class="sr-only">(current)</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href={{"/blogs/" | relative_url}}>
          Blogs
          {% if has_new_blogs %}
            <span class="new-badge">NEW{% if new_blogs_count > 1 %}<sup>{{ new_blogs_count }}</sup>{% endif %}</span>
          {% endif %}
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href={{"/tags/" | relative_url}}>Tags</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href={{"/about/" | relative_url}}>About</a>
      </li>
    </ul>
  </div>

  <!-- Simple Jekyll Search Ïä§ÌÅ¨Î¶ΩÌä∏ Ï∂îÍ∞Ä -->
  <script src="https://unpkg.com/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var sjs = SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '{{ "/search.json" | relative_url }}',
        searchResultTemplate: '<li><a href="{url}">{title}</a> <small>{tags}</small></li>',
        noResultsText: 'No results found',
        limit: 10,
        fuzzy: false
      });
    });
  </script>
</nav>

<style>
/* NEW Badge Styles - Compatible with older browsers */
.new-badge {
  display: inline-block;
  background: #ff6b6b;
  background: -webkit-linear-gradient(45deg, #ff6b6b, #ff8e8e);
  background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
  color: white;
  font-size: 0.65rem;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 10px;
  margin-left: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 4px rgba(255, 107, 107, 0.3);
  position: relative;
  top: -1px;
  
  /* Animation - with fallback for older browsers */
  -webkit-animation: newBadgePulse 2s ease-in-out infinite;
  animation: newBadgePulse 2s ease-in-out infinite;
  
  /* Transition fallback */
  -webkit-transition: all 0.3s ease;
  transition: all 0.3s ease;
}

/* Counter styling */
.new-badge sup {
  font-size: 0.5rem;
  margin-left: 1px;
  font-weight: 800;
}

/* Pulse animation with prefixes */
@-webkit-keyframes newBadgePulse {
  0%, 100% {
    -webkit-transform: scale(1);
    transform: scale(1);
    box-shadow: 0 2px 4px rgba(255, 107, 107, 0.3);
  }
  50% {
    -webkit-transform: scale(1.05);
    transform: scale(1.05);
    box-shadow: 0 3px 8px rgba(255, 107, 107, 0.5);
  }
}

@keyframes newBadgePulse {
  0%, 100% {
    -webkit-transform: scale(1);
    transform: scale(1);
    box-shadow: 0 2px 4px rgba(255, 107, 107, 0.3);
  }
  50% {
    -webkit-transform: scale(1.05);
    transform: scale(1.05);
    box-shadow: 0 3px 8px rgba(255, 107, 107, 0.5);
  }
}

/* Hover effects */
.nav-link:hover .new-badge {
  background: #ff5252;
  background: -webkit-linear-gradient(45deg, #ff5252, #ff7979);
  background: linear-gradient(45deg, #ff5252, #ff7979);
  -webkit-animation-duration: 1s;
  animation-duration: 1s;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .new-badge {
    font-size: 0.6rem;
    padding: 1px 4px;
    margin-left: 2px;
  }
  
  .new-badge sup {
    font-size: 0.45rem;
  }
}

/* Fallback for browsers without animation support */
.no-cssanimations .new-badge {
  -webkit-animation: none;
  animation: none;
}
</style>