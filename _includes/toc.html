<!-- Table of Contents Include -->
<div class="blog-toc">
  <h4>ðŸ“– Table of Contents</h4>
  <ul id="toc-list">
    <!-- TOC will be generated by JavaScript -->
  </ul>
</div>

<script>
(function() {
  'use strict';
  
  let tocGenerated = false;
  
  function generateTOC() {
    if (tocGenerated) return true;
    
    console.log('=== Attempting TOC Generation ===');
    
    const postContent = document.querySelector('.post-content');
    const tocList = document.getElementById('toc-list');
    const tocContainer = document.querySelector('.blog-toc');
    
    if (!postContent || !tocList || !tocContainer) {
      console.log('Required elements not found');
      return false;
    }
    
    const headings = postContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
    console.log('Found', headings.length, 'headings');
    
    if (headings.length === 0) {
      tocContainer.style.display = 'none';
      console.log('No headings found, hiding TOC');
      return true;
    }
    
    // Clear existing content
    tocList.innerHTML = '';
    
    // Generate TOC items
    headings.forEach(function(heading, index) {
      // Ensure heading has an ID
      if (!heading.id) {
        const headingText = heading.textContent.trim()
          .toLowerCase()
          .replace(/[^\w\s-]/g, '') // Remove special characters
          .replace(/\s+/g, '-'); // Replace spaces with hyphens
        heading.id = headingText || ('heading-' + index);
      }
      
      // Create list item
      const li = document.createElement('li');
      const a = document.createElement('a');
      
      a.href = '#' + heading.id;
      a.textContent = heading.textContent.trim();
      a.className = 'toc-link';
      
      // Style based on heading level
      const level = parseInt(heading.tagName.substring(1));
      li.style.marginLeft = ((level - 1) * 0.8) + 'rem';
      li.style.marginBottom = '0.3rem';
      li.style.listStyle = 'none';
      
      a.style.textDecoration = 'none';
      a.style.fontSize = Math.max(0.85, 1.1 - (level * 0.08)) + 'rem';
      a.style.color = level <= 2 ? '#2c3e50' : '#5a6c7d';
      a.style.fontWeight = level <= 2 ? '600' : '400';
      a.style.display = 'block';
      a.style.padding = '0.2rem 0';
      a.style.borderRadius = '3px';
      a.style.transition = 'all 0.2s ease';
      
      // Hover effects
      a.addEventListener('mouseenter', function() {
        this.style.backgroundColor = '#f8f9fa';
        this.style.color = '#007bff';
        this.style.paddingLeft = '0.5rem';
      });
      
      a.addEventListener('mouseleave', function() {
        this.style.backgroundColor = 'transparent';
        this.style.color = level <= 2 ? '#2c3e50' : '#5a6c7d';
        this.style.paddingLeft = '0';
      });
      
      // Smooth scroll on click
      a.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.getElementById(heading.id);
        if (target) {
          target.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
          });
          
          // Add temporary highlight effect
          target.style.backgroundColor = '#fff3cd';
          target.style.transition = 'background-color 0.3s ease';
          setTimeout(function() {
            target.style.backgroundColor = '';
          }, 1500);
        }
      });
      
      li.appendChild(a);
      tocList.appendChild(li);
    });
    
    // Show TOC container
    tocContainer.style.display = 'block';
    tocGenerated = true;
    
    console.log('âœ… TOC generated successfully with', headings.length, 'items');
    return true;
  }
  
  // Multiple initialization attempts
  function initTOC() {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(generateTOC, 100);
      });
    } else {
      generateTOC();
    }
    
    // Fallback attempts
    setTimeout(generateTOC, 500);
    setTimeout(generateTOC, 1000);
    setTimeout(generateTOC, 2000);
  }
  
  // Initialize
  initTOC();
  
  // Handle dynamic content loading (if applicable)
  if (window.MutationObserver) {
    const observer = new MutationObserver(function(mutations) {
      let shouldRegenerate = false;
      mutations.forEach(function(mutation) {
        if (mutation.type === 'childList' && 
            mutation.target.classList && 
            mutation.target.classList.contains('post-content')) {
          shouldRegenerate = true;
        }
      });
      
      if (shouldRegenerate && !tocGenerated) {
        setTimeout(generateTOC, 200);
      }
    });
    
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  }
})();
</script>

<style>
.blog-toc {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 0.5rem;
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.blog-toc h4 {
  margin-top: 0;
  margin-bottom: 1rem;
  color: #2c3e50;
  font-size: 1.1rem;
  font-weight: 600;
  border-bottom: 2px solid #007bff;
  padding-bottom: 0.5rem;
}

#toc-list {
  margin: 0;
  padding: 0;
}

#toc-list li {
  list-style: none;
}

.toc-link {
  color: #495057;
  text-decoration: none;
}

.toc-link:hover {
  color: #007bff;
  text-decoration: none;
}

/* Responsive adjustments */
@media (max-width: 991.98px) {
  .blog-toc {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
}
</style>